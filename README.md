# ERC20 Token Listener & Fraud Detection System

A real-time monitoring system for detecting and analyzing ERC20 token deployments across multiple blockchains. The system identifies potential phishing attempts, counterfeit tokens, and other suspicious activities using advanced detection algorithms.

## Features
- **Multi-Chain Support**: Monitors Ethereum, Base, Polygon, and Arbitrum blockchains
- **Advanced Fraud Detection**:
  - Phishing token detection
  - Counterfeit token identification
  - Similarity scoring for token names and symbols
  - Risk assessment and classification
- **Real-time Monitoring**: Listens for new contract deployments 24/7
- **Comprehensive Data Storage**: Stores detailed token information and risk assessments in Supabase
- **Configurable Risk Thresholds**: Adjustable sensitivity for fraud detection

## Prerequisites
- Node.js (v16 or higher)
- Python 3.8+
- Alchemy API keys for supported networks (Ethereum, Base, Polygon, Arbitrum)
- Supabase project with service role key
- Python virtual environment (recommended)

## Setup

1. **Clone the repository:**
   ```sh
   git clone https://github.com/On-Analytics/ERC20_Token_Listener.git
   cd ERC20_Token_Listener
   ```

2. **Install Node.js dependencies:**
   ```sh
   npm install
   ```

3. **Set up Python environment and install dependencies:**
   ```sh
   # Create and activate virtual environment (recommended)
   python -m venv venv
   .\venv\Scripts\activate  # Windows
   # or
   source venv/bin/activate  # Linux/Mac

   # Install Python dependencies
   pip install -r requirements.txt
   ```

4. **Configure environment variables:**
   Create a `.env` file in the root directory with the following content:
   ```env
   # Alchemy API Keys
   ALCHEMY_API_KEY_ETH=your-ethereum-mainnet-key
   ALCHEMY_API_KEY_BASE=your-base-key
   ALCHEMY_API_KEY_POLYGON=your-polygon-key
   ALCHEMY_API_KEY_ARBITRUM=your-arbitrum-key
   
   # Supabase Configuration
   SUPABASE_URL=your-supabase-url
   SUPABASE_SERVICE_KEY=your-supabase-service-key
   
   # Optional: Adjust detection thresholds (0-1, higher = more sensitive)
   PHISHING_THRESHOLD=0.7
   COUNTERFEIT_THRESHOLD=0.65
   ```

5. **Database Setup:**
   Run the following SQL in your Supabase SQL editor to create the required tables:
   ```sql
   -- Main tokens table
   create table public.erc20_tokens (
     id bigint generated by default as identity primary key,
     contract_address text not null,
     creator_address text not null,
     created_block_timestamp timestamptz not null,
     name text not null,
     symbol text not null,
     decimals integer not null,
     blockchain text not null,
     fraud_type text,
     risk_category text,
     detection_details jsonb,
     created_at timestamptz default now(),
     unique(contract_address, blockchain)
   );

   -- Safe tokens reference
   create table public.safe_tokens (
     id bigint generated by default as identity primary key,
     name text not null,
     symbol text not null,
     contract_address text,
     blockchain text,
     created_at timestamptz default now()
   );

   -- Fake directory for known scams
   create table public.fake_directory (
     id bigint generated by default as identity primary key,
     name text not null,
     symbol text not null,
     original_name text,
     original_symbol text,
     risk_level text,
     created_at timestamptz default now()
   );
   ```

## Usage

### Starting the Listener
```sh
# Start the listener (runs in the background)
npm start

# For development with log output
node listener.js
```

### Monitoring the System
- The system will automatically detect new ERC20 token deployments on all configured blockchains
- Each token is analyzed for potential fraud and risk factors
- Results are stored in the Supabase database in real-time

### Viewing Results
Query the `erc20_tokens` table in Supabase to view detected tokens and their risk assessments:
```sql
-- View high-risk tokens
SELECT * FROM erc20_tokens 
WHERE risk_category = 'high risk' 
ORDER BY created_block_timestamp DESC;

-- View detection statistics
SELECT 
  risk_category,
  COUNT(*) as count,
  COUNT(*) * 100.0 / (SELECT COUNT(*) FROM erc20_tokens) as percentage
FROM erc20_tokens
GROUP BY risk_category;
```

## Configuration

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `ALCHEMY_API_KEY_*` | API keys for each supported network | Required |
| `SUPABASE_URL` | Your Supabase project URL | Required |
| `SUPABASE_SERVICE_KEY` | Supabase service role key | Required |
| `PHISHING_THRESHOLD` | Sensitivity for phishing detection (0-1) | 0.7 |
| `COUNTERFEIT_THRESHOLD` | Sensitivity for counterfeit detection (0-1) | 0.65 |

### Detection Parameters

You can adjust the following parameters in the code to fine-tune detection:

1. **Phishing Detection** (`phishing_detection.py`):
   - Common phishing terms list
   - URL pattern matching
   - Token name/symbol analysis

2. **Counterfeit Detection** (`counterfeit_detection.py`):
   - Levenshtein distance thresholds
   - Common scam patterns
   - Known safe token list matching

## Maintenance

### Updating Safe Tokens List
To add tokens to the safe list, insert them into the `safe_tokens` table:
```sql
INSERT INTO public.safe_tokens (name, symbol, contract_address, blockchain)
VALUES 
  ('Ethereum', 'ETH', '0x0000000000000000000000000000000000000000', 'ethereum'),
  ('Wrapped BTC', 'WBTC', '0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599', 'ethereum');
```

### Reporting False Positives/Negatives
1. Check the `detection_details` JSON for the token
2. Update the `fake_directory` table as needed
3. Consider adjusting thresholds if needed

## Troubleshooting

### Common Issues

1. **Missing Dependencies**
   ```sh
   # Reinstall dependencies if needed
   npm install
   pip install -r requirements.txt
   ```

2. **Database Connection Issues**
   - Verify Supabase URL and service key
   - Check network connectivity
   - Ensure tables exist with correct schema

3. **High False Positive Rate**
   - Increase threshold values in `.env`
   - Review and update safe tokens list
   - Check for common patterns in false positives

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Acknowledgements

- [Alchemy](https://www.alchemy.com/) for blockchain node infrastructure
- [Supabase](https://supabase.com/) for the open-source Firebase alternative
- [python-Levenshtein](https://github.com/ztane/python-Levenshtein) for string similarity calculations
